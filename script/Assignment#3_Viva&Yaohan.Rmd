---
title: "Assignment#3_Logistic Regression"
author: "Viva"
date: "`r Sys.Date()`"
output:
  html_document:
    keep_md: yes
    toc: yes
    theme: flatly
    toc_float: yes
    code_folding: hide
    number_sections: no
    fontsize: 12pt
  pdf_document:
    toc: yes
---

<style>
.kable thead tr th, .table thead tr th {
  text-align: left !important;}
table.kable, table.table {
  width: 100% !important;}
  body {
  line-height: 1.6;
  font-size: 16px
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  cache = TRUE,
  dpi = 150)
options(scipen = 999)

if(!require(pacman)){install.packages("pacman"); library(pacman)}
p_load(tidyverse, sf, units, nngeo, tmap, tinytex, kableExtra, janitor, classInt,
       patchwork, here, tidycensus, lwgeom, lsr, haven, descr, RColorBrewer, stargazer,
       car, FNN, GGally, MASS, ISLR2, spdep, caret, ckanr, grid, gridExtra, ggcorrplot,
       jtools, broom, tufte, rmarkdown, corrr, RSocrata, viridis, spatstat, raster, knitr,
       classInt)

library(conflicted)
conflicts_prefer(dplyr::select)
conflicts_prefer(dplyr::filter)
```

# Question 1
## Choose variable


```{r variable}
load(here::here("data/raw/cpln505_assignment3_voting_data_abb.rda"))
# Viva's path
all <- read_csv('/Users/Viva Wan/Documents/GitHub/Local/cpln505_assignment3_voting_data.csv')
# Yaohan's path
all <- read_csv('/Users/Viva Wan/Documents/GitHub/Local/cpln505_assignment3_voting_data.csv')

dat <- all %>%
  select(VCF0004,VCF0704a,
         VCF0101,VCF0104,VCF0105a,VCF0128,VCF0114,VCF0140a,VCF0147,VCF0148a,VCF0108,
         VCF0878,VCF9239,VCF0656,
         VCF0302,VCF0113,VCF9025) %>%
  filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
  rename(# target variables
         year = VCF0004,
         candidate = VCF0704a, 
         # demographics
         age = VCF0101,
         gender = VCF0104,
         race = VCF0105a,
         religion = VCF0128,
         income = VCF0114,
         education = VCF0140a,
         class = VCF0148a,
         hispanic = VCF0108,
         # political ideology
         lgbt = VCF0878,
         gun = VCF9239,
         trust = VCF0656,
         # Political Affiliation
         party = VCF0302,
         south = VCF0113,
         govern = VCF9025)%>%
  filter(candidate != 0)

  filter(!(gender %in% c(0,3)), 
         race != 9, 
         religion !=0,
         income != 0,
         education!=9, 
         class != 9, 
         !(hispanic %in% c(8,9)),
         !(lgbt %in% c(8,9)), #DK - 8 as a type?
         !(gun %in% c(-8,-9)),
         trust != 999,
         !(party %in% c(8,9)),
         govern !=0, #DK has 1400+ in 2016
         )#all just 1702
  mutate(gender_cat = as.facter(recode(gender,
                                       `1` = 'male',
                                       `2` = 'female')))
  
table(dat$candidate,dat$year)



##clean data
dat <- dat.voting %>%
  filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
  rename(candidate = VCF0704a, 
         year = VCF0004,
         gender = VCF0104,
         race = VCF0105a,
         religion = VCF0128,
         income = VCF0114,
         education = VCF0140a,
         marital = VCF0147,
         class = VCF0148a,
         party = VCF0302,
         hispanic = VCF0108,
         south = VCF0113) %>%
  select(year, candidate, race) %>%
  filter(race != 9, candidate != 0) %>%
  mutate(race_cat = as.factor(recode(race,
                                     `1` = "white",
                                     `2` = "black",
                                     `3` = "other",
                                     `4` = "other",
                                     `5` = "other",
                                     `6` = "other")))

```



